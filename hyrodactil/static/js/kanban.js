// Generated by CoffeeScript 1.6.2
(function() {
  var $;

  $ = jQuery;

  $.fn.extend({
    kanban: function(options) {
      var settings, _savePositions;

      settings = {
        opacity: 0.8,
        containment: 'document',
        cursor: 'move',
        distance: 5,
        zIndex: 7777,
        connectWith: '.kanban-list-cards',
        change: function(event, ui) {
          return ui.placeholder.addClass('kanban-card-placeholder');
        },
        stop: function(event, ui) {
          var $column, card, data, i, _i, _len, _ref;

          $column = ui.item.parent();
          data = {
            stage: $column.data('stage-id'),
            positions: []
          };
          _ref = $column.children();
          for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
            card = _ref[i];
            data.positions.push([$(card).data('id'), i]);
          }
          return _savePositions(data);
        },
        others: {
          containerClass: 'kanban-list-cards',
          columnClass: 'kanban-list',
          columnHeaderClass: 'kanban-list-header',
          cardClass: 'kanban-card',
          data: null,
          updatePositionsURL: ''
        }
      };
      settings = $.extend(true, settings, options);
      _savePositions = function(data) {
        return $.post(settings.others.updatePositionsURL, {
          data: JSON.stringify(data)
        }, function(result) {
          return true;
        });
      };
      return this.each(function() {
        return $('.' + settings.others.containerClass).sortable(settings);
      });
    }
  });

}).call(this);
