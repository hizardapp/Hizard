// Generated by CoffeeScript 1.6.2
(function() {
  var $;

  $ = jQuery;

  $.fn.extend({
    kanban: function(options) {
      var differentSortable, settings, _savePositions;

      differentSortable = false;
      settings = {
        opacity: 0.8,
        containment: 'document',
        cursor: 'move',
        distance: 5,
        zIndex: 7777,
        connectWith: '.kanban-list-cards',
        change: function(event, ui) {
          return ui.placeholder.addClass('kanban-card-placeholder');
        },
        receive: function(event, ui) {
          return differentSortable = true;
        },
        stop: function(event, ui) {
          return _savePositions(ui.item.parent());
        },
        others: {
          containerClass: 'kanban-list-cards',
          columnClass: 'kanban-list',
          columnHeaderClass: 'kanban-list-header',
          cardClass: 'kanban-card',
          data: null,
          updatePositionsURL: ''
        }
      };
      settings = $.extend(true, settings, options);
      _savePositions = function($column) {
        var card, data, dataToSend, i, _i, _len, _ref;

        data = {
          stage: differentSortable ? $column.data('stage-id') : null,
          positions: []
        };
        _ref = $column.children();
        for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
          card = _ref[i];
          data.positions.push([$(card).data('id'), i]);
        }
        dataToSend = {
          data: JSON.stringify(data)
        };
        differentSortable = false;
        return $.post(settings.others.updatePositionsURL, dataToSend, function(result) {
          return true;
        });
      };
      return this.each(function() {
        return $('.' + settings.others.containerClass).sortable(settings);
      });
    }
  });

}).call(this);
