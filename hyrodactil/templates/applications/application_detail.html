{% extends "base_app.html" %}

{% load i18n %}

{% block content %}
  <header class="applicant">
    <h1>{{ application.applicant.first_name }} {{ application.applicant.last_name }}</h1>
  </header>

  <br><br>

  <div class="section-container tabs" data-section="" data-options="deep_linking: true">

    <section class="section">
      <p class="title"><a href="#dashboard">{% trans 'Dashboard' %}</a></p>
      <div class="content" data-slug="dashboard">
        {% include 'applications/_dashboard_tab.html' with form=form application=application %}
      </div>
    </section>

    <section class="section">
      <p class="title"><a href="#profile">{% trans 'Profile' %}</a></p>
      <div class="content" data-slug="profile">
        {% include 'applications/_profile_tab.html' with application=application %}
      </div>
    </section>

    <section class="section">
      <p class="title"><a href="#resume">{% trans 'Resume' %}</a></p>
      <div class="content" data-slug="resume">
        {% include 'applications/_resume_tab.html' with application=application %}
      </div>
    </section>

    <section class="section">
      <p class="title"><a href="#notes">{% trans 'Discussion' %}</a></p>
      <div class="content" data-slug="notes">
        {% include 'applications/_discussion_tab.html' with application=application new_message_form=new_message_form discussion=discussion %}
      </div>
    </section>
  </div>
{% endblock %}

{% block extra-js %}
<script type="text/javascript">
  $("a.reply-link").click(function (event) {
      event.preventDefault();
      var new_form = $("#new-message-form").clone(),
          link = $(this),
          small_parent = $(link.parents("small")[0]),
          parent_message = link.attr("reply-to");
      small_parent.after(new_form);
      new_form.find("#id_parent").val(parent_message);
  });

  $("textarea#id_note").on("keydown", function () {
    var textarea = $(this),
        str = textarea.val(),
        cols = textarea.attr("cols"),
        linecount = 0;

    $.each(str.split("\n"), function (i, line) {
      linecount += (Math.ceil(line.length / cols) || 1);
    })
    textarea.attr("rows", linecount + 1);
  });

  $(function () {
    if ($("#transition-form").find("ul.errorlist").length > 0) {
      $("a[data-reveal-id=transition-form-modal]").click();
    }
  })
</script>
{% endblock extra-js %}
