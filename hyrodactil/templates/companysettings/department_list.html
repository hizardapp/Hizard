{% extends "base_app.html" %}

{% load i18n %}
{% load companysettings %}
{% load staticfiles %}


{% block content %}
  <h2 class="page-header">{% trans "Departments" %}</h2>

    <div>

      <table class="large-8 columns">
        <thead>
          <tr class="row">
            <th class="large-10 columns">{% trans "Name" %}</th>
            <th class="large-2 columns"></th>
          </tr>
        </thead>

        <tbody>
          {% for department in department_list %}
            <tr class="row {% if department.id == error_object_id %}error-table{% endif %}" data-id="{{ department.id }}">
                <td class="large-10 columns update-object">
                  <i class="icon-pencil icon-large"></i>
                  <span>{{ department.name }}</span>
                </td>
                <td class="large-2 columns text-right">
                  <a href="{% url 'companysettings:delete_department' department.id %}">{% trans "Delete" %}</a>
                </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="large-4 columns">
        {% include 'companysettings/_side_form.html' with error_object_id=error_object_id %}
      </div>

    </div>

{% endblock content %}

{% block extra-js %}
  <script>
    $(document).ready(function() {
      var createUrl = "{% url 'companysettings:create_department'%}";
      var updateUrl = "{% url 'companysettings:update_department' 0 %}";
      var updateText = "{% trans 'Update' %}";
      var saveText = "{% trans 'Save' %}";
      var $form = $('.company-settings-form');

      {% if error_object_id %}
        $form.attr('action', "{% url 'companysettings:update_department' error_object_id %}");
        $form.find(':input[type=submit]').val(updateText);
      {% else %}
        $form.attr('action', createUrl);
        $form.find(':input[type=submit]').val(saveText);
      {% endif %}

      $('.update-object').click(function() {
        var $td = $(this);
        var id = $td.parent().data('id');
        var text = $td.find('span').text();
        $form.attr('action', updateUrl.replace(0, id));
        $form.find('input[type=text]').val(text);
        $form.find('input[type=submit]').val(updateText);
      });

      $('.clear-inputs').click(function() {
        $form.attr('action', createUrl);
        $form.find('input[type=text]').val('');
        $form.find(':input[type=submit]').val(saveText);
      });
    });
  </script>
{% endblock extra-js %}
